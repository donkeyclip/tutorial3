/*
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */

import { getAnId } from '../_coreUtils/helper';

/**
 * @param {object} ingredients -
 * {
 *      id
 *      attrs
 *      props
 *      Incident
 *      plugin_npm_name
 *      Channel
 *      context (optional)
 *      mcid (optional)
 * }
 * */
export default function incidentFromIngredients(ingredients, isClip = false) {
  const thirdProp = isClip
    ? ingredients.DescriptiveIncident
    : { context: ingredients.context, mcid: ingredients.mcid };
  const incident = new ingredients.Incident(
    ingredients.attrs,
    { ...ingredients.props, id: ingredients.id || getAnId() },
    thirdProp,
  );

  // we keep this code here this way so we have it in just one place and not spread
  // around the various constructors of the various supported Incident types.
  incident.mc_plugin_npm_name = ingredients.plugin_npm_name;
  incident.plugin_channel_class = ingredients.Channel;
  incident.DescriptiveIncident = ingredients.DescriptiveIncident;
  return incident;
}
